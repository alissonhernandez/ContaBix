<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nuevo Asiento - Contabix</title>

    <!-- Estilos generales (navbar, fondo, etc.) -->
    <link rel="stylesheet" th:href="@{/css/inicio.css}">

    <!-- Estilos SOLO del formulario del asiento -->
    <link rel="stylesheet" th:href="@{/css/libro-diario-form.css}">

    <!-- Choices.js para buscar dentro del combo de cuentas -->
    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/choices.js/public/assets/styles/choices.min.css"/>
</head>
<body>

<nav class="navbar">
    <div class="logo">Contabix</div>
    <div class="hamburger" id="hamburger">&#9776;</div>
    <ul class="nav-links" id="nav-links">
        <li><a th:href="@{/inicio}">Inicio</a></li>
        <li><a th:href="@{/perfil}">Perfil</a></li>
        <li><a th:href="@{/libro-diario}" class="active">Libro Diario</a></li>
        <li><a th:href="@{/libro-mayor}">Libro Mayor</a></li>
        <li><a th:href="@{/documentos}">Documentos Fuente</a></li>
        <li><a th:href="@{/auditoria}" class="active">Auditor√≠a</a></li>

        <li><a th:href="@{/admin/usuarios}">Gesti√≥n de Usuarios</a></li>
        <li><a th:href="@{/logout}">Cerrar sesi√≥n</a></li>
    </ul>
</nav>

<main>
    <!-- T√≠tulo grande centrado como en tu segunda captura -->
    <h1 class="titulo-asiento">Registro de Asiento Contable</h1>

    <div class="asiento-form">
        <!-- Mensaje de error en rojo, debajo del t√≠tulo -->
        <div th:if="${error}" class="mensaje-error" th:text="${error}"></div>

        <form th:action="@{/libro-diario/guardar}"
              th:object="${asiento}"
              method="post"
              enctype="multipart/form-data">

            <input type="hidden" th:field="*{id}"/>

            <!-- Campos principales -->
            <div class="form-group">
                <label>Fecha:</label>
                <input type="date" th:field="*{fecha}">
            </div>

            <div class="form-group">
                <label>Descripci√≥n:</label>
                <input type="text" th:field="*{descripcion}" required>
            </div>

            <div class="form-group">
                <label>Documento fuente (PDF, opcional):</label>
                <input type="file" name="archivoDocumento" accept="application/pdf">
            </div>

            <!-- Detalles -->
            <div class="table-section">
                <h3>Detalles del Asiento</h3>

                <table class="tabla-asiento">
                    <thead>
                    <tr>
                        <th>Cuenta</th>
                        <th>Debe</th>
                        <th>Haber</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="detalle, iter : *{detalles}">
                        <td>
                            <select class="sel-cuenta"
                                    th:field="*{detalles[__${iter.index}__].cuenta.id}">
                                <option value="">-- Seleccione cuenta --</option>
                                <option th:each="cuenta : ${cuentas}"
                                        th:value="${cuenta.id}"
                                        th:text="${cuenta.codigo + ' - ' + cuenta.nombre}">
                                </option>
                            </select>
                        </td>
                        <td>
                            <div class="input-money">
                                <span>$</span>
                                <input type="number"
                                       step="0.01"
                                       min="0"
                                       th:field="*{detalles[__${iter.index}__].debe}">
                            </div>
                        </td>
                        <td>
                            <div class="input-money">
                                <span>$</span>
                                <input type="number"
                                       step="0.01"
                                       min="0"
                                       th:field="*{detalles[__${iter.index}__].haber}">
                            </div>
                        </td>
                    </tr>
                    </tbody>
                </table>

                <!-- Texto informativo -->

            </div>

            <!-- Botones centrados como en la captura -->
            <div class="form-actions">
                <button type="submit" class="btn-guardar">
                    üíæ Guardar Asiento
                </button>
                <a th:href="@{/libro-diario}" class="btn-cancelar">
                    Cancelar
                </a>
            </div>
        </form>
    </div>
</main>

<footer>
    &copy; 2025 Contabix | Sistema Contable
</footer>

<script src="https://cdn.jsdelivr.net/npm/choices.js/public/assets/scripts/choices.min.js"></script>
<script>
    // men√∫ hamburguesa
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('nav-links');
    hamburger.addEventListener('click', () => {
        navLinks.classList.toggle('active');
    });

    // activar b√∫squeda en combos de cuenta (Choices.js)
    document.addEventListener('DOMContentLoaded', function () {
        const selects = document.querySelectorAll('.sel-cuenta');
        selects.forEach(function (sel) {
            new Choices(sel, {
                searchEnabled: true,
                itemSelectText: '',
                shouldSort: false
            });
        });
    });
</script>

</body>
</html>
