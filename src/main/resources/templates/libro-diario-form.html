<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es">
<head>
    <meta charset="UTF-8">
    <title>Nuevo Asiento - Contabix</title>
    <link rel="stylesheet" th:href="@{/css/inicio.css}">
    <link rel="stylesheet" th:href="@{/css/libro-diario-list.css}">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

<nav class="navbar">
    <div class="logo">Contabix</div>
    <div class="hamburger" id="hamburger">&#9776;</div>
    <ul class="nav-links" id="nav-links">
        <li><a th:href="@{/inicio}">Inicio</a></li>
        <li><a th:href="@{/perfil}">Perfil</a></li>
        <li><a th:href="@{/libro-diario}" class="active">Libro Diario</a></li>
        <li><a th:href="@{/libro-mayor}">Libro Mayor</a></li>
        <li><a th:href="@{/documentos}">Documentos Fuente</a></li>
        <li><a th:href="@{/admin/usuarios}">Gesti贸n de Usuarios</a></li>
        <li><a th:href="@{/logout}">Cerrar sesi贸n</a></li>
    </ul>
</nav>

<main>
    <h1 th:text="${asiento.id == null} ? 'Nuevo Asiento' : 'Editar Asiento'"></h1>

    <div th:if="${error}" class="alert-danger" th:text="${error}"></div>

    <div class="form-container">
        <form th:action="@{/libro-diario/guardar}"
              th:object="${asiento}"
              method="post"
              enctype="multipart/form-data">

            <!-- necesario para edici贸n -->
            <input type="hidden" th:field="*{id}"/>

            <div class="form-group">
                <label>Fecha:</label>
                <input type="date" th:field="*{fecha}">
            </div>

            <div class="form-group">
                <label>Descripci贸n:</label>
                <input type="text" th:field="*{descripcion}" required>
            </div>

            <!--  Documento fuente -->
            <div class="form-group">
                <label>Documento fuente (PDF, opcional):</label>
                <input type="file" name="archivoDocumento" accept="application/pdf">
            </div>

            <!-- ===== Detalles del asiento: Cuenta / Debe / Haber ===== -->
            <h2 style="margin-top: 20px; margin-bottom: 10px;">Detalles del Asiento</h2>

            <table class="tabla-detalle-asiento">
                <thead>
                <tr>
                    <th>Cuenta</th>
                    <th>Debe</th>
                    <th>Haber</th>
                </tr>
                </thead>
                <tbody>
                <tr th:each="detalle, iter : *{detalles}">
                    <td>
                        <select th:field="*{detalles[__${iter.index}__].cuenta.id}">
                            <option value="">-- Seleccione cuenta --</option>
                            <option th:each="cuenta : ${cuentas}"
                                    th:value="${cuenta.id}"
                                    th:text="${cuenta.codigo + ' - ' + cuenta.nombre}">
                            </option>
                        </select>
                    </td>
                    <td>
                        <input type="number"
                               step="0.01"
                               min="0"
                               th:field="*{detalles[__${iter.index}__].debe}">
                    </td>
                    <td>
                        <input type="number"
                               step="0.01"
                               min="0"
                               th:field="*{detalles[__${iter.index}__].haber}">
                    </td>
                </tr>
                </tbody>
            </table>

            <p class="nota-detalle">
                La suma del Debe debe ser igual a la suma del Haber.
            </p>

            <div class="form-actions">
                <button type="submit" class="btn">Guardar</button>
                <a th:href="@{/libro-diario}" class="btn btn-secundario">Cancelar</a>
            </div>
        </form>
    </div>
</main>

<footer>
    &copy; 2025 Contabix | Sistema Contable
</footer>

<script>
    const hamburger = document.getElementById('hamburger');
    const navLinks = document.getElementById('nav-links');
    hamburger.addEventListener('click', () => {
        navLinks.classList.toggle('active');
    });
</script>

</body>
</html>
